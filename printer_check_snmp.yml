- name: Check if SNMPv2 is working on remote host
  hosts: "{{ branch_no }}-printer{{printer_no}}"
  connection: local
  gather_facts: no
 
  tasks:
    - name: Get SNMPv2 printer model
      local_action: command snmpget -v2c -c public {{ inventory_hostname }} SNMPv2-MIB::sysDescr.0
      register: response

    - name: Set printer model fact
      set_fact:
        printer_model: "{{ response.stdout | regex_replace('.*STRING: (.*); .*', '\\1') | regex_replace('.*STRING: (.*)', '\\1')}}"

    - name: Configure printer Xerox
      
      block:
        - name: Print model
          debug:
            msg: "To jest drukarka Xerox"
         
        - name: get email address
          uri:
            url: "http://{{inventory_hostname}}/addressbook/GetIndividualInABook.cgi"
            method: POST
            body_format: json
            body:
              ispeedNo: "0"
              start: "0"
              limit: "1000"
            headers:
              Cookie: SESSION_ID=3554
              statusSelected: 1
          register: output
          
        - name: Pokaz output
          debug:
            var: output
    
        - name: Pokaz rozdzielczość
          debug:
            msg: "Rozdzieloczość ustawiona na {{scan_resolution}}"
          when: scan_resolution is defined
        
        - name: Pokaz rozdzielczość
          debug:
            msg: "Email ustawiona na {{email}}"
          when: email is defined  
          
      when: printer_model == 'Xerox WorkCentre 3345'

    - name: Configure printer Samsung
      block:
        - name: Print model
          debug:
            msg: "To jest drukarka Samsung"
            
        - name: Pokaz rozdzielczość
          debug:
            msg: "Rozdzieloczość ustawiona na {{scan_resolution}}"
          when: scan_resolution is defined
        
        - name: Pokaz rozdzielczość
          debug:
            msg: "Email ustawiona na {{email}}"
          when: email is defined                
          
      when: printer_model == 'Samsung SL-M3870FW'      
